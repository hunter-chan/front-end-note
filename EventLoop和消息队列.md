#### 描述一下EventLoop事件环和消息队列，宏任务和微任务

先从JavaScript的单线程说起，JavaScript为何会设计成单线程的语言，JavaScript运行在浏览器中，是为了操作dom的，假设有存在多线程来操作dom则将可能会导致多线程同时修改dom结构而导致出现问题。



那么由于单线程，而有的操作是会阻塞当前任务的，于是便有了异步编程，异步编程的做法，callback回调函数，订阅/发布，promise。不过本质都是回调函数。



EventLoop是一种循环机制，JavaScript的主线程会去轮询一些队列，然后从这些队列中，去按顺序执行任务。



消息队列中存放了宏任务，例如定时器任务的时间到了，任务就会被放进这个队列中。一开始整块的脚本会作为一个宏任务来执行，同步的会直接执行，异步的则发起之后，继续往后执行。异步任务在执行完之后，会将其回调放置在宏任务队列或者微任务队列中。在当前的宏任务完成之后，会去查询微任务，然后将微任务队列的任务清空（这里用清空是因为可能会出现微任务继续生成微任务，这个也是考虑在内的）。进而完成界面渲染，然后再查看webworker是否有内容需要执行，然后再从消息队列中取出一个宏任务，往下执行。



宏任务，理解为每次执行栈中执行的代码即是一个宏任务，浏览器让界面渲染和JavaScript代码交替执行，在每个宏任务之间会去执行界面渲染。包括了，很多的setTimeout，setInterval，整体代码，IO，UI交互事件，postMessage，messageChannel。



微任务，作为小任务，在每次宏任务执行完毕之后，会去清空微任务队列，其响应速度会比宏任务更快，无需等待UI的渲染。包括了Promise.then，queueMircotask，对象监听，MutaionObserver。



[浏览器与node中的EventLoop执行不同](https://blog.fundebug.com/2019/01/15/diffrences-of-browser-and-node-in-event-loop/)

