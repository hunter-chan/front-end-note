#### 为什么要有https，以及连接的时候怎么样的流程，并且https是如何保证安全通讯的？

首先从http说起，http建立在TCP之上，端口号为80，http的传输是明文传输，里面的内容很容易就被人窃取，并且很容易发生中间人攻击，导致信息不安全。所以需要进行加密处理。正常情况应该使用对称加密，但是秘钥需要怎么确定就变得棘手。后来出现了RSA算法，即公私钥加密算法，算法跟幂运算有关，公钥加密的内容只有私钥才能解密，用来保证数据传输，而私钥加密的用公钥可以解开，可以用来确认消息是属于某个人发的。



https即是在tcp建立之后，再建立一层ssl/tls层，最后再进行http通讯的。ssl/tls层的验证过程如下，

- 客户端先发起请求client hello，请求内容包括了本身的tls/ssl版本，随机数，多种客户端支持的加密算法。
- 接下来服务器会返回一个server hello的回应，并确定了tls/ssl版本，服务端随机数，已经决定使用的加密算法，加密算法会影响到后边的流程。
- 然后是server certificate消息，服务端会将其CA证书发送给客户端，客户端会对这个CA证书进行验证。
- 接下来是发送server hello done，这时候需要生成秘钥的内容双方均都已经获取。此时进行CA证书的认证，先读取证书中的明文信息，包括了该网站的基本信息，还有公钥，以及一个签名，然后使用其CA认证中心的公钥，将服务器证书中的签名解密，得到了一串散列数据，将网站基本信息进行散列计算，得到的内容跟解密出来的数据进行对比，如果通过，则继续下一步。否则会报提示。
- 接下来是根据加密算法的不同，会在生成一个第三随机数，可能是客户端生成的 协商预备主秘钥 ，也可能是DH公钥等。
- 然后客户端和服务端此时根据前两个随机数和上一步生成的秘钥，然后各自在本地生成秘钥，这个秘钥将作为接下来通讯的对称秘钥。
- change cipher spec协议，需要通知对方，接下来的内容都将更改协议，使用秘钥来进行加解密传输。
- Finished消息，这个是使用对称秘钥加密的第一条信息。



因为CA认证中心会对该服务器的信息进行散列并使用CA的私钥加密生成的的内容一并发给服务器，以后服务器在接受访问的时候会将此证书交给客户端，而客户端中需要知道该CA认证中心是可信任的，并使用其公钥去解密服务器发来的证书，然后做验证。通过了才会认为通讯的对方确实是该服务器主体。

